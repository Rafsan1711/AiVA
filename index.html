<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AiVA - AI Virtual Assistant</title>

  <!-- Tailwind (optional) + fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Chessboard CSS -->
  <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css" crossorigin="anonymous">

  <!-- Prism for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

  <!-- Main stylesheet (paste style.css provided separately) -->
  <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-gray-900 text-white h-screen overflow-hidden">
  <!-- Terms Modal -->
  <div id="termsModal" class="modal-hidden terms-modal">
    <div class="terms-modal-content">
      <div class="terms-header">
        <div class="logo-placeholder">AI</div>
        <h2>Terms of Service & Privacy Policy</h2>
      </div>
      <div class="terms-body">
        <h3>Terms of Service</h3>
        <p>By using AiVA, you agree to use this service responsibly. Do not share personal, sensitive, or illegal content. This service is provided as-is without warranties.</p>
        <h3>Privacy Policy</h3>
        <p>We collect minimal data necessary for service functionality. Conversations may be processed by AI services. We don't sell your data to third parties.</p>
        <h3>Usage Limits</h3>
        <p>Each chat session is limited to 7 messages to ensure fair usage and optimal performance. Progress is saved automatically.</p>
      </div>
      <div class="terms-actions">
        <button id="acceptTerms" class="btn-primary">Accept</button>
        <button id="declineTerms" class="btn-ghost">Decline</button>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div id="authModal" class="modal-hidden auth-modal">
    <div class="auth-modal-content">
      <div class="auth-header">
        <div class="logo-placeholder">AI</div>
        <h1>AiVA</h1>
        <p>AI Virtual Assistant</p>
      </div>

      <div id="loginForm" class="auth-form">
        <h2>Sign In</h2>
        <input id="loginEmail" type="email" placeholder="Email" />
        <input id="loginPassword" type="password" placeholder="Password" />
        <button id="loginBtn" class="btn-primary">Sign In</button>
        <button id="googleSignInBtn" class="btn-google">Sign in with Google</button>
        <p class="small">Don't have an account? <button id="showSignUp" class="link-btn">Sign Up</button></p>
      </div>

      <div id="signUpForm" class="auth-form hidden">
        <h2>Sign Up</h2>
        <input id="signUpEmail" type="email" placeholder="Email" />
        <input id="signUpPassword" type="password" placeholder="Password" />
        <input id="confirmPassword" type="password" placeholder="Confirm Password" />
        <button id="signUpBtn" class="btn-primary">Sign Up</button>
        <button id="googleSignUpBtn" class="btn-google">Sign up with Google</button>
        <p class="small">Already have an account? <button id="showSignIn" class="link-btn">Sign In</button></p>
      </div>
    </div>
  </div>

  <!-- Settings / Archive / Plugins modals (kept as placeholders; full markup below) -->
  <!-- Plugins modal: contains plugin cards including Chess and Code Studio -->
  <div id="pluginsModal" class="modal-hidden plugins-modal">
    <div class="plugins-modal-content">
      <div class="plugins-header">
        <h2>Plugins</h2>
        <button id="closePlugins" class="icon-close">√ó</button>
      </div>

      <div class="plugins-grid">
        <!-- Chess plugin card (existing) -->
        <div class="plugin-card" id="chessPlugin" data-plugin="chess">
          <div class="plugin-card-top">
            <div class="plugin-icon">‚ôó</div>
            <div>
              <h3>Chess Master</h3>
              <p class="muted">Play chess games with AI opponent</p>
            </div>
          </div>
          <div class="plugin-card-bottom">
            <div id="chessBadge" class="plugin-disabled-badge">Disabled</div>
            <button onclick="togglePlugin('chess')" class="btn-primary full">Enable Plugin</button>
          </div>
        </div>

        <!-- Code Studio plugin card (NEW) -->
        <div class="plugin-card" id="codePluginCard" data-plugin="code_editor">
          <div class="plugin-card-top">
            <div class="plugin-icon">üíª</div>
            <div>
              <h3>Code Studio</h3>
              <p class="muted">Create / edit files with AI-assisted feature generation & debugging (single persistent chat)</p>
            </div>
          </div>
          <div class="plugin-card-bottom">
            <div id="codeBadge" class="plugin-disabled-badge">Disabled</div>
            <button id="toggleCodePluginBtn" class="btn-primary full">Enable Plugin</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Code Studio Modal (single persistent chat plugin) -->
  <div id="codePluginModal" class="code-plugin-modal" aria-hidden="true">
    <div class="code-plugin-window">
      <!-- Files Pane -->
      <div class="files-pane">
        <div class="files-top">
          <div class="logo-placeholder">AI</div>
          <div class="files-title">Code Studio</div>
          <div class="files-actions">
            <button id="closeCodePlugin" class="btn-ghost">Close</button>
            <button id="deleteCodePlugin" class="btn-ghost text-red">Delete</button>
          </div>
        </div>

        <div class="file-create">
          <button id="createFileToggleBtn" class="btn-primary">Create a new file +</button>
          <div id="createFileForm" class="create-form hidden">
            <input id="newFileName" placeholder="Filename (e.g., index.html)" />
            <textarea id="newFileContent" rows="6" placeholder="Paste file code here..."></textarea>
            <div class="create-form-actions">
              <button id="createFileBtn" class="btn-primary">Create</button>
              <button id="cancelCreateFileBtn" class="btn-ghost">Cancel</button>
            </div>
          </div>
        </div>

        <div class="files-list-title">Files</div>
        <div id="filesList" class="files-list">
          <!-- JS will render file cards here -->
        </div>

        <div class="files-bottom">
          <button id="exportAllBtn" class="btn-ghost full">Export files (ZIP)</button>
          <button id="syncNowBtn" class="btn-ghost full">Sync with Firebase</button>
        </div>
      </div>

      <!-- Editor / Chat Pane -->
      <div class="editor-pane">
        <div class="editor-top">
          <div>
            <h2>Code Studio ‚Äî AI Assisted</h2>
            <div id="currentFilename" class="muted">No file opened</div>
          </div>
          <div class="editor-actions">
            <div id="pluginStatus" class="chip">Single Chat</div>
            <button id="commitFileBtn" class="btn-primary" disabled>Commit Changes</button>
            <button id="downloadFileBtn" class="btn-ghost" disabled>Download</button>
          </div>
        </div>

        <div class="feature-controls">
          <textarea id="featureInput" placeholder="Describe a feature (e.g., signup/login improvements)"></textarea>
          <div class="feature-buttons">
            <button id="generateFeatureBtn" class="btn-primary">Generate feature with AI</button>
            <button id="sendFeatureBtn" class="btn-ghost">Send</button>
          </div>
        </div>

        <div id="chatArea" class="feature-chat" aria-live="polite">
          <!-- Chat messages (AI / user) will appear here -->
        </div>

        <div class="final-controls">
          <button id="finalSatisfiedBtn" class="btn-primary hidden">Satisfied</button>
          <button id="finalNotSatisfiedBtn" class="btn-ghost hidden">Not satisfied</button>
        </div>

        <div id="generatedArea" class="code-view">
          <!-- AI generated code cards and debug views -->
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal for Code Plugin -->
  <div id="deleteCodeModal" class="delete-modal hidden">
    <div class="delete-modal-content">
      <h3>Delete Code Studio Chat & Files</h3>
      <p>Deleting will remove all files and chat history associated with this plugin for your account. This action is irreversible.</p>
      <label>
        <input id="confirmDeleteCheckbox" type="checkbox" /> I understand this will permanently delete files and chat history.
      </label>
      <div class="delete-actions">
        <button id="cancelDeleteCode" class="btn-ghost">Cancel</button>
        <button id="confirmDeleteCode" class="btn-primary" disabled>Delete</button>
      </div>
    </div>
  </div>

  <!-- Main App layout (sidebar, chat area, input) - keep original markup and chess pieces intact -->
  <div id="mainApp" class="app-hidden main-app">
    <!-- Desktop Sidebar -->
    <aside class="desktop-sidebar">
      <div class="sidebar-header">
        <div class="logo-placeholder">AI</div>
        <div>
          <h1>AiVA</h1>
          <p class="muted">AI Virtual Assistant</p>
        </div>
        <div class="sidebar-controls">
          <button id="newChatBtn" class="btn-ghost">+</button>
          <button id="settingsBtn" class="btn-ghost">‚öô</button>
          <button id="archiveBtn" class="btn-ghost">üìÅ</button>
        </div>
      </div>

      <div class="sidebar-plugins">
        <button id="pluginsBtn" class="btn-ghost full">üß© Plugins</button>
        <div id="enabledPlugins" class="enabled-plugins"></div>
      </div>

      <div class="sidebar-search">
        <input id="searchChats" placeholder="Search conversations..." />
      </div>

      <div class="sidebar-history" id="chatHistory"></div>

      <div class="sidebar-user" id="userInfo">
        <div id="userAvatar" class="avatar"></div>
        <div>
          <div id="userName">User</div>
          <div class="muted">Online</div>
        </div>
      </div>
    </aside>

    <!-- Chat area -->
    <main class="chat-area-main">
      <header class="chat-header">
        <div class="chat-header-left">
          <div id="chatAvatar" class="avatar small">AI</div>
          <div>
            <div id="chatTitle">AiVA Assistant</div>
            <div id="statusIndicator" class="muted">Online</div>
          </div>
        </div>

        <div class="chat-header-right">
          <div id="messageCount" class="muted">0/7</div>
          <button id="chatMenuBtn" class="btn-ghost">‚ãÆ</button>
          <div id="chatDropdown" class="dropdown hidden">
            <button id="archiveChat">üìÅ Archive Chat</button>
            <button id="deleteChat" class="danger">üóëÔ∏è Delete Chat</button>
          </div>
        </div>
      </header>

      <section id="messagesContainer" class="messages-container">
        <div class="welcome-placeholder">
          <div class="logo-placeholder pulse">AI</div>
          <h3>Welcome to AiVA</h3>
          <p>Your AI Virtual Assistant is ready to help!</p>
          <p class="muted">You can send up to 7 messages per chat</p>
        </div>
      </section>

      <footer class="chat-input">
        <textarea id="messageInput" placeholder="Type your message..." rows="1"></textarea>
        <button id="sendBtn" class="btn-primary">Send</button>
      </footer>
    </main>
  </div>

  <!-- Chess dependencies (kept intact) -->
  <script src="https://code.jquery.com/jquery-3.5.1.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js" crossorigin="anonymous"></script>
  <script src="js/chess.js"></script>

  <!-- Sounds (kept same) -->
  <audio id="moveSound" src="sounds/move.mp3"></audio>
  <audio id="captureSound" src="sounds/capture.mp3"></audio>
  <audio id="promoteSound" src="sounds/promote.mp3"></audio>
  <audio id="castlingSound" src="sounds/castling.mp3"></audio>
  <audio id="incorrectMoveSound" src="sounds/incorrect-move.mp3"></audio>
  <audio id="checkSound" src="sounds/check.mp3"></audio>
  <audio id="checkmateSound" src="sounds/checkmate.mp3"></audio>

  <!-- Firebase SDKs (script.js will use them; DO NOT remove) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <!-- Prism (syntax highlight lib used by generated code view) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-markup.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-json.min.js"></script>

  <!-- Main JS (will be provided when you ask) -->
  <script src="script.js"></script>
</body>
</html>
